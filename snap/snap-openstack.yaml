setup:
  users:
    keystone: [keystone]
  default_owner: "root:keystone"
  default_dir_mode: 0750
  default_file_mode: 0640
  dirs:
    - "{snap_common}/etc"
    - "{snap_common}/etc/keystone"
    - "{snap_common}/etc/keystone/conf.d"
    - "{snap_common}/etc/nginx"
    - "{snap_common}/etc/uwsgi"
    - "{snap_common}/fernet-keys"
    - "{snap_common}/lib"
    - "{snap_common}/lock"
    - "{snap_common}/log"
    - "{snap_common}/run"
  templates:
    admin.ini.j2: "{snap_common}/etc/uwsgi/admin.ini"
    keystone-nginx.conf.j2: "{snap_common}/etc/nginx/sites-enabled/keystone.conf"
    keystone-snap.conf.j2: "{snap_common}/etc/keystone/conf.d/keystone-snap.conf"
    nginx.conf.j2: "{snap_common}/etc/nginx/nginx.conf"
    public.ini.j2: "{snap_common}/etc/uwsgi/public.ini"
  copyfiles:
    "{snap}/usr/conf": "{snap_common}/etc/nginx"
  rchown:
    "{snap_common}/fernet-keys": "keystone:keystone"
    "{snap_common}/lib": "keystone:keystone"
    "{snap_common}/lock": "keystone:keystone"
    "{snap_common}/log": "keystone:keystone"
    "{snap_common}/run": "keystone:keystone"
entry_points:
  keystone-manage:
    binary: "{snap}/bin/keystone-manage"
    config-files:
      - "{snap}/etc/keystone/keystone.conf"
      - "{snap_common}/etc/keystone/keystone.conf"
    config-dirs:
      - "{snap_common}/etc/keystone/conf.d"
    run_as:
      keystone: [keystone]
  keystone-uwsgi:
    type: uwsgi
    uwsgi-dir: "{snap_common}/etc/uwsgi"
    uwsgi-log: "{snap_common}/log/uwsgi.log"
    config-files:
      - "{snap}/etc/keystone/keystone.conf"
      - "{snap_common}/etc/keystone/keystone.conf"
    config-dirs:
      - "{snap_common}/etc/keystone/conf.d"
    log-file: "{snap_common}/log/keystone.log"
    run_as:
      keystone: [keystone]
  keystone-nginx:
    type: nginx
    config-file: "{snap_common}/etc/nginx/nginx.conf"
    # NOTE: The nginx.conf template drops privileges for worker processes
    run_as:
      root: [root]
