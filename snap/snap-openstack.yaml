setup_keystone:
  user: keystone
  group: keystone
  dirs:
    - "{snap_common}/etc"
    - "{snap_common}/etc/keystone"
    - "{snap_common}/etc/keystone/credential-keys"
    - "{snap_common}/etc/keystone/fernet-keys"
    - "{snap_common}/etc/keystone/keystone.conf.d"
    - "{snap_common}/etc/uwsgi"
    - "{snap_common}/lib"
    - "{snap_common}/lib/keystone"
    - "{snap_common}/lock"
    - "{snap_common}/lock/keystone"
    - "{snap_common}/log"
    - "{snap_common}/log/keystone"
    - "{snap_common}/log/uwsgi"
    - "{snap_common}/run"
    - "{snap_common}/run/keystone"
  symlinks:
    "{snap_common}/etc/keystone": /etc/keystone
    "{snap_common}/etc/uwsgi": /etc/uwsgi
    "{snap_common}/lib/keystone": /var/lib/keystone
    "{snap_common}/lock/keystone": /var/lock/keystone
    "{snap_common}/log/keystone": /var/log/keystone
    "{snap_common}/log/uwsgi": /var/log/uwsgi
    "{snap_common}/run/keystone": /var/run/keystone
  templates:
    keystone-snap.conf.j2: "{snap_common}/etc/keystone/keystone.conf.d/keystone-snap.conf"
    admin.ini.j2: "{snap_common}/etc/uwsgi/keystone-admin.ini"
    public.ini.j2: "{snap_common}/etc/uwsgi/keystone-public.ini"
  copyfiles:
    "{snap}/etc/keystone": "{snap_common}/etc/keystone"
  chown:
    "{snap_common}/etc/keystone/fernet-keys": "keystone:keystone"
  rchown:
    "{snap_common}/lib/keystone": "keystone:keystone"
    "{snap_common}/lock/keystone": "keystone:keystone"
    "{snap_common}/log/keystone": "keystone:keystone"
    "{snap_common}/log/uwsgi": "keystone:keystone"
    "{snap_common}/run/keystone": "keystone:keystone"
    "{snap_common}/etc/keystone/credential-keys": "keystone:keystone"
entry_points:
  keystone-manage:
    binary: keystone-manage
    config-files:
      - "/etc/keystone/keystone.conf"
    config-dirs:
      - "/etc/keystone/keystone.conf.d"
    run-as: keystone:keystone
  keystone-api:
    type: uwsgi
    uwsgi-dir: "/etc/uwsgi"
    log-file: "/var/log/uwsgi/keystone.log"
    run-as: keystone:keystone
